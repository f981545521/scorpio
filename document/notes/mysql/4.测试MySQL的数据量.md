## 工作中遇到的表数据量会很大

### SQL

```mysql
CREATE TABLE `r_sku_storage_goods` (
  `id` bigint NOT NULL AUTO_INCREMENT COMMENT '主键ID',
  `sku_id` bigint NOT NULL COMMENT 'SKU ID',
  `storage_id` bigint NOT NULL DEFAULT '0' COMMENT '库点ID',
  `section_id` bigint NOT NULL DEFAULT '0' COMMENT '库区ID',
  `bin_id` bigint NOT NULL DEFAULT '0' COMMENT '库位ID',
  `goods_identity_code` varchar(64) CHARACTER SET utf8mb4 COLLATE utf8mb4_bin NOT NULL COMMENT '物品识别码',
  `processing_plan_receipt_id` bigint NOT NULL COMMENT '加工单ID',
  `batch_number` varchar(64) CHARACTER SET utf8mb4 COLLATE utf8mb4_bin DEFAULT NULL COMMENT '批号',
  `expiry_date` date NOT NULL COMMENT '有效期',
  `production_date` date DEFAULT NULL COMMENT '生产日期',
  `status` int NOT NULL DEFAULT '1' COMMENT '物品状态：1-正常使用 10-删除',
  `purchase_price` decimal(10,2) DEFAULT NULL COMMENT '采购价格',
  `trace_storage_id` bigint NOT NULL DEFAULT '0' COMMENT '追溯库点ID(用来记录出库前所在的库点)',
  `consume_time` datetime DEFAULT NULL COMMENT '消耗时间',
  `settlement_time` datetime DEFAULT NULL COMMENT '结算时间',
  `create_user` bigint NOT NULL COMMENT '创建人ID',
  `create_time` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间,默认当前时间',
  `update_user` bigint DEFAULT NULL COMMENT '最后修改人ID',
  `update_time` datetime DEFAULT NULL COMMENT '最后修改时间',
  `remark` varchar(1024) CHARACTER SET utf8mb4 COLLATE utf8mb4_bin DEFAULT NULL COMMENT '备注',
  PRIMARY KEY (`id`) USING BTREE,
  UNIQUE KEY `idx_sku_storage_goods_goodsIdentityCode` (`goods_identity_code`) USING HASH,
  KEY `idx_sku_storage_goods_skuid` (`sku_id`) USING BTREE,
  KEY `idx_sku_storage_goods_storageid` (`storage_id`) USING BTREE,
  KEY `idx_sku_storage_goods_expirydate` (`expiry_date`) USING BTREE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_bin COMMENT='仓库物品表';
```

### 准备数据

##### 随机数

MySQL中的随机数

```mysql
-- 随机UUID
SELECT UUID_SHORT(); -- 纯数字
SELECT UUID();       -- UUID

-- 产生500~550之间的随机数
SELECT FLOOR( 500 + RAND() * (550 - 500));
-- 产生0到10000间的随机数
SELECT RAND() * 10000;          -- 带小数
SELECT FLOOR(RAND() * 10000);   -- 整数

-- 减少一天
SELECT DATE_SUB(now(), INTERVAL 2 DAY);
-- 日期格式化
SELECT DATE_FORMAT(DATE_SUB(now(), INTERVAL 2 DAY),'%Y%m%d');
```

##### 组合使用，创建存储过程

```mysql

CREATE DEFINER=`root`@`localhost` PROCEDURE `insert_storage_goods`(IN total BIGINT)
BEGIN
DECLARE start_key BIGINT DEFAULT 0;
DECLARE max_id BIGINT DEFAULT 0;
SELECT COUNT(1) into max_id from product;
WHILE start_key<total
DO
SET max_id=max_id+1;
INSERT INTO `r_sku_storage_goods`(`sku_id`, `storage_id`, `section_id`, `bin_id`, `goods_identity_code`, `processing_plan_receipt_id`, `batch_number`, `expiry_date`, `production_date`, `status`, `purchase_price`, `trace_storage_id`, `consume_time`, `settlement_time`, `create_user`, `create_time`, `update_user`, `update_time`, `remark`) VALUES (FLOOR( 500 + RAND() * (550 - 500)), FLOOR( 800 + RAND() * (1000 - 800)), 0, 0, UUID_SHORT(), 110, DATE_FORMAT(DATE_SUB(now(), INTERVAL FLOOR(RAND() * 1095) DAY),'%Y%m%d'), '2030-08-01', '2020-07-01', 1, 3000.00, 0, NULL, NULL, 12, now(), 12, now(), NULL);
SET start_key=start_key+1;
COMMIT;
END WHILE;
END
```

##### 测试

用CALL来调用函数：

```mysql
-- 插入9条数据
call insert_storage_goods(9) ;
-- 插入50w数据
call insert_storage_goods(500000);
> OK
> 时间: 1963.974s


```

### 测试

```mysql
-- 1000010 100W数据量
SELECT COUNT(*) from r_sku_storage_goods
> OK
> 时间: 1.76s


SELECT COUNT(id) FROM r_sku_storage_goods
> OK
> 时间: 1.732s


SELECT COUNT(1) FROM r_sku_storage_goods
> OK
> 时间: 1.697s
```




